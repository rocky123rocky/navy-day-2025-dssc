import { CartoonCharacter } from './types';

export const CARTOON_CHARACTERS: CartoonCharacter[] = [
    { name: 'Mickey Mouse', gradient: 'from-red-500 to-yellow-400', gender: 'Male' },
    { name: 'SpongeBob SquarePants', gradient: 'from-yellow-300 to-green-400', gender: 'Male' },
    { name: 'Bugs Bunny', gradient: 'from-gray-400 to-pink-400', gender: 'Male' },
    { name: 'Homer Simpson', gradient: 'from-yellow-400 to-blue-500', gender: 'Male' },
    { name: 'Popeye the Sailor', gradient: 'from-blue-700 to-white', gender: 'Male' },
    { name: 'Scooby-Doo', gradient: 'from-yellow-600 to-blue-400', gender: 'Male' },
    { name: 'Tom Cat', gradient: 'from-gray-500 to-gray-700', gender: 'Male' },
    { name: 'Jerry Mouse', gradient: 'from-yellow-700 to-yellow-500', gender: 'Male' },
    { name: 'Daffy Duck', gradient: 'from-black to-green-500', gender: 'Male' },
    { name: 'Fred Flintstone', gradient: 'from-orange-500 to-blue-300', gender: 'Male' },
    { name: 'Goofy', gradient: 'from-orange-400 to-green-500', gender: 'Male' },
    { name: 'Donald Duck', gradient: 'from-blue-500 to-white', gender: 'Male' },
    { name: 'Pikachu', gradient: 'from-yellow-400 to-red-500', gender: 'Neutral' },
    { name: 'Winnie the Pooh', gradient: 'from-red-600 to-yellow-400', gender: 'Male' },
    { name: 'Shrek', gradient: 'from-green-600 to-yellow-800', gender: 'Male' },
    { name: 'Buzz Lightyear', gradient: 'from-purple-600 to-green-400', gender: 'Male' },
    { name: 'Woody', gradient: 'from-yellow-500 to-blue-600', gender: 'Male' },
    { name: 'Elsa', gradient: 'from-blue-300 to-purple-400', gender: 'Female' },
    { name: 'Optimus Prime', gradient: 'from-red-600 to-blue-700', gender: 'Male' },
    { name: 'Iron Man', gradient: 'from-red-700 to-yellow-500', gender: 'Male' },
    { name: 'Captain America', gradient: 'from-blue-600 to-red-600', gender: 'Male' },
    { name: 'Spider-Man', gradient: 'from-red-500 to-blue-500', gender: 'Male' },
    { name: 'Hulk', gradient: 'from-green-500 to-purple-500', gender: 'Male' },
    { name: 'Thor', gradient: 'from-gray-700 to-red-500', gender: 'Male' },
    { name: 'Batman', gradient: 'from-black to-yellow-400', gender: 'Male' },
    { name: 'Superman', gradient: 'from-blue-600 to-red-500', gender: 'Male' },
    { name: 'Wonder Woman', gradient: 'from-red-600 to-yellow-400', gender: 'Female' },
    { name: 'The Joker', gradient: 'from-purple-500 to-green-400', gender: 'Male' },
    { name: 'Harley Quinn', gradient: 'from-red-500 to-black', gender: 'Female' },
    { name: 'Bender', gradient: 'from-gray-600 to-yellow-200', gender: 'Male' },
    { name: 'Rick Sanchez', gradient: 'from-blue-200 to-green-300', gender: 'Male' },
    { name: 'Morty Smith', gradient: 'from-yellow-300 to-blue-400', gender: 'Male' },
    { name: 'Stewie Griffin', gradient: 'from-yellow-400 to-red-500', gender: 'Male' },
    { name: 'Peter Griffin', gradient: 'from-green-400 to-yellow-200', gender: 'Male' },
    { name: 'Eric Cartman', gradient: 'from-red-500 to-blue-300', gender: 'Male' },
    { name: 'Naruto Uzumaki', gradient: 'from-orange-500 to-yellow-300', gender: 'Male' },
    { name: 'Goku', gradient: 'from-orange-600 to-blue-500', gender: 'Male' },
    { name: 'Sailor Moon', gradient: 'from-pink-400 to-blue-400', gender: 'Female' },
    { name: 'Hello Kitty', gradient: 'from-pink-300 to-red-400', gender: 'Female' },
    { name: 'Totoro', gradient: 'from-gray-500 to-gray-300', gender: 'Male' },
    { name: 'Stitch', gradient: 'from-blue-500 to-purple-400', gender: 'Male' },
    { name: 'Moana', gradient: 'from-orange-400 to-blue-300', gender: 'Female' },
    { name: 'Simba', gradient: 'from-yellow-600 to-orange-500', gender: 'Male' },
    { name: 'Timon', gradient: 'from-yellow-700 to-red-600', gender: 'Male' },
    { name: 'Pumbaa', gradient: 'from-red-800 to-yellow-600', gender: 'Male' },
    { name: 'Aladdin', gradient: 'from-purple-500 to-yellow-200', gender: 'Male' },
    { name: 'Genie', gradient: 'from-blue-400 to-blue-600', gender: 'Male' },
    { name: 'Ariel', gradient: 'from-green-400 to-red-500', gender: 'Female' },
    { name: 'Belle', gradient: 'from-yellow-400 to-orange-600', gender: 'Female' },
    { name: 'Cinderella', gradient: 'from-blue-300 to-white', gender: 'Female' },
    { name: 'Snow White', gradient: 'from-blue-600 to-yellow-300', gender: 'Female' },
    { name: 'WALL-E', gradient: 'from-yellow-500 to-gray-600', gender: 'Male' },
    { name: 'Mr. Incredible', gradient: 'from-red-600 to-black', gender: 'Male' },
    { name: 'Elastigirl', gradient: 'from-red-500 to-orange-500', gender: 'Female' },
    { name: 'Dory', gradient: 'from-blue-500 to-yellow-400', gender: 'Female' },
    { name: 'Nemo', gradient: 'from-orange-500 to-white', gender: 'Male' },
    { name: 'Mike Wazowski', gradient: 'from-green-400 to-white', gender: 'Male' },
    { name: 'Sulley', gradient: 'from-blue-400 to-purple-400', gender: 'Male' },
    { name: 'Joy', gradient: 'from-yellow-300 to-blue-300', gender: 'Female' },
    { name: 'Sadness', gradient: 'from-blue-500 to-gray-400', gender: 'Female' },
    { name: 'Anger', gradient: 'from-red-600 to-yellow-500', gender: 'Male' },
    { name: 'Disgust', gradient: 'from-green-500 to-purple-300', gender: 'Female' },
    { name: 'Fear', gradient: 'from-purple-500 to-pink-300', gender: 'Male' },
    { name: 'Carl Fredricksen', gradient: 'from-gray-400 to-blue-300', gender: 'Male' },
    { name: 'Minions', gradient: 'from-yellow-400 to-blue-500', gender: 'Male' },
    { name: 'Gru', gradient: 'from-gray-800 to-gray-600', gender: 'Male' },
    { name: 'Paddington Bear', gradient: 'from-blue-600 to-red-500', gender: 'Male' },
    { name: 'Garfield', gradient: 'from-orange-500 to-black', gender: 'Male' },
    { name: 'Snoopy', gradient: 'from-white to-black', gender: 'Male' },
    { name: 'Charlie Brown', gradient: 'from-yellow-400 to-orange-400', gender: 'Male' },
    { name: 'Finn the Human', gradient: 'from-blue-300 to-white', gender: 'Male' },
    { name: 'Jake the Dog', gradient: 'from-yellow-500 to-orange-400', gender: 'Male' },
    { name: 'Peppa Pig', gradient: 'from-pink-400 to-red-400', gender: 'Female' },
    { name: 'Bluey', gradient: 'from-blue-400 to-blue-200', gender: 'Female' },
    { name: 'Phineas', gradient: 'from-orange-400 to-red-500', gender: 'Male' },
    { name: 'Ferb', gradient: 'from-green-400 to-purple-400', gender: 'Male' },
    { name: 'Kim Possible', gradient: 'from-green-600 to-orange-500', gender: 'Female' },
    { name: 'Ron Stoppable', gradient: 'from-orange-500 to-gray-700', gender: 'Male' },
    { name: 'Powerpuff Girls', gradient: 'from-pink-400 to-green-400', gender: 'Female' },
    { name: 'Dexter', gradient: 'from-white to-purple-500', gender: 'Male' },
    { name: 'Johnny Bravo', gradient: 'from-yellow-400 to-blue-600', gender: 'Male' },
    { name: 'Courage the Cowardly Dog', gradient: 'from-pink-300 to-black', gender: 'Male' },
    { name: 'Ed, Edd n Eddy', gradient: 'from-yellow-300 to-green-500', gender: 'Male' },
    { name: 'Samurai Jack', gradient: 'from-white to-red-600', gender: 'Male' },
    { name: 'Aang', gradient: 'from-orange-300 to-blue-400', gender: 'Male' },
    { name: 'Korra', gradient: 'from-blue-500 to-orange-400', gender: 'Female' },
];


/**
 * A simple and effective string hashing function (djb2).
 * @param str The string to hash.
 * @returns A 32-bit integer hash.
 */
const stringHash = (str: string): number => {
    let hash = 5381;
    for (let i = 0; i < str.length; i++) {
        const char = str.charCodeAt(i);
        hash = ((hash << 5) + hash) + char; // hash * 33 + c
        hash |= 0; // Convert to 32bit integer
    }
    return Math.abs(hash);
};

/**
 * Matches a character deterministically based on image features.
 * This version is more robust to minor changes in lighting or position.
 * It works by analyzing features from a central crop of the image, simulating
 * a focus on facial features like intensity, standard deviation, and histogram.
 * @param imageData The pixel data from the captured image.
 * @param characters The pool of characters to match from.
 * @returns A matched cartoon character.
 */
export const matchCharacter = (imageData: ImageData, characters: CartoonCharacter[]): CartoonCharacter => {
    const { width, height, data } = imageData;

    // 1. Crop to a central region to focus on the face and reduce background noise.
    // Assuming face is in the middle 50% width and 70% height.
    const cropX = Math.floor(width * 0.25);
    const cropY = Math.floor(height * 0.15);
    const cropWidth = Math.floor(width * 0.5);
    const cropHeight = Math.floor(height * 0.7);

    const lumaValues: number[] = [];
    const histogram = new Array(8).fill(0);

    // 2. Calculate features (luma, histogram) from the cropped region.
    for (let y = cropY; y < cropY + cropHeight; y++) {
        for (let x = cropX; x < cropX + cropWidth; x++) {
            const i = (y * width + x) * 4; // 4 bytes per pixel (RGBA)
            const r = data[i];
            const g = data[i + 1];
            const b = data[i + 2];
            
            // Calculate luma (perceptual brightness)
            const luma = 0.299 * r + 0.587 * g + 0.114 * b;
            lumaValues.push(luma);

            // Populate histogram with 8 bins
            const bin = Math.min(7, Math.floor(luma / 32)); // 256 levels / 8 bins = 32 levels per bin
            histogram[bin]++;
        }
    }

    if (lumaValues.length === 0) {
        // Fallback for empty or invalid image data
        console.warn("Could not extract features from image, falling back to default character.");
        return characters[0];
    }

    // 3. Calculate statistics: mean (intensity) and standard deviation (contrast).
    const meanLuma = lumaValues.reduce((a, b) => a + b, 0) / lumaValues.length;
    const stdDevLuma = Math.sqrt(
        lumaValues.map(x => Math.pow(x - meanLuma, 2)).reduce((a, b) => a + b, 0) / lumaValues.length
    );

    // 4. Create a stable feature string by rounding/bucketing values.
    // This makes the hash tolerant to small, insignificant changes in camera input.
    const featureString = [
        Math.round(meanLuma / 5) * 5, // Round to nearest 5 to create buckets
        Math.round(stdDevLuma / 5) * 5, // Round to nearest 5
        ...histogram.map(h => Math.round(h / 100)) // Normalize and round histogram bins
    ].join(',');

    // 5. Hash the feature string to get a deterministic index.
    const hash = stringHash(featureString);
    const index = hash % characters.length;
    
    return characters[index];
};
